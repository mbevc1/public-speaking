---
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig
metadata:
  name: mb
  region: eu-west-1
  tags:
    managed_by: 'eksctl'
    karpenter.sh/discovery: mb
    #kubernetes.io/cluster/mb: true
  version: '1.23'

#vpc:
#    clusterEndpoints:
#        publicAccess: true
#        privateAccess: true

iam:
  withOIDC: true
#  serviceAccounts:
#  - metadata:
#      name: karpenter
#      namespace: karpenter
#    attachPolicy:
#      Version: "2012-10-17"
#      Statement:
#      - Effect: Allow
#        Resource: "*"
#        Action:
#        # Write Operations
#        - "ec2:CreateLaunchTemplate"
#        - "ec2:CreateFleet"
#        - "ec2:RunInstances"
#        - "ec2:CreateTags"
#        - "ec2:TerminateInstances"
#        - "ec2:DeleteLaunchTemplate"
#        # Read Operations
#        - "ec2:DescribeLaunchTemplates"
#        - "ec2:DescribeInstances"
#        - "ec2:DescribeSecurityGroups"
#        - "ec2:DescribeSubnets"
#        - "ec2:DescribeImages"
#        - "ec2:DescribeInstanceTypes"
#        - "ec2:DescribeInstanceTypeOfferings"
#        - "ec2:DescribeAvailabilityZones"
#        - "ec2:DescribeSpotPriceHistory"
#        - "ssm:GetParameter"
#        - "pricing:GetProducts"
#        # for !Sub "arn:${AWS::Partition}:iam::${AWS::AccountId}:role/KarpenterNodeRole-${ClusterName}"
#        - "iam:PassRole"

#karpenter:
#  version: 'v0.18.1' # Exact version must be specifiedi
#  createServiceAccount: true # default is false
#  defaultInstanceProfile: 'KarpenterNodeInstanceProfile' # default is to use the IAM instance profile created by eksctl

fargateProfiles:
  - name: karpenter
    selectors:
      - namespace: karpenter
      - namespace: monitoring
      - namespace: kube-system
  # All workloads in the "kube-system" Kubernetes namespace will be
  # scheduled onto Fargate:
  #- name: kube-system
  #  selectors:
  #    - namespace: kube-system
